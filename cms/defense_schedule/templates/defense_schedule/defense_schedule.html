{% extends 'defense_schedule/base.html' %}
{% load static %}
{% load tz %}
{% load custom_filters %}  <!-- Load custom filters -->

{% block content %}
{{ block.super }}  <!-- This will include the calendar from base.html -->
{% if user.is_authenticated %}

<div class="table-container" style="margin: 0px; overflow-x: hidden; height=100%" > 
    <div class="header-container">
        <h1 class="page-title"> Calendar </h1>

        <div class="header-buttons">

            {% if request.user.is_current_coordinator %}

                <button class="btn btn-sm btn-outline-secondary" id="toggle-defense-schedule-btn">
                    <i class="fas fa-compress"></i> Minimize Schedule
                </button>
                <button class="btn btn-sm btn-outline-secondary d-none" id="maximize-defense-schedule-btn">
                    <i class="fas fa-expand"></i> Maximize Schedule
                </button>

                <a href="{% url 'view-schedule' %}" class="btn btn-primary btn-sm">
                    <i class="fas fa-calendar-alt icon icon-margin"></i> Mutual Availability 
                </a>

                <a href="javascript:history.back()" class="btn btn-outline-secondary btn-sm">   <i class="fas fa-arrow-left"></i> </a>
            </div>
            {% endif %}
        </div>

    </center> 

   <div class="row w-100">
    <!-- Flex Container for Calendar & Schedule List -->
    <div class="col-md-12 d-flex flex-wrap">
        
        <!-- Calendar Section (70%) -->
        <div class="my_calendar" id="calendar-column" style="width: 65%;">
            <div id='calendar'></div>
        </div>

        <!-- Schedule List Section (35%) -->
        <div id="defense-schedule-column" class="table-container" style="width: 35%; padding-left: 15px;">
            <div class="header-container">
                <h1 class="page-title" style="text-transform: none;">Defense Schedule</h1>
                <div class="header-buttons">
                    <button id="create-defense-schedule-btn" class="btn btn-success btn-sm">
                        <i class="fas fa-plus-circle icon" style="color: white;"></i> Create
                    </button>
                      <!-- Delete All Button -->
                    <button id="delete-all-defense-schedules-btn" class="btn btn-danger btn-sm">
                        <i class="fas fa-trash-alt icon" style="color: white;"></i> Delete All
                    </button>
                </div>
            </div>        

            <div class="table-scroll-area" style="overflow-x: auto;">
                <table class="table table-striped mt-3 student-table">
                    <thead>
                        <tr>
                            <th scope="col" style="width: 200px;">Date</th>
                            <th scope="col" class="project-name-header">Project</th>
                            <th>Adviser</th>
                            <th>Panel 1</th>
                            <th>Panel 2</th>
                            <th>Panel 3</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for event_data in events_with_panel %}
                        <tr>
                            <td style="padding: 8px; white-space: nowrap;">
                                {% with start_date=event_data.event.start|date:"M. d, Y" %}
                                {% with end_date=event_data.event.end|date:"M. d, Y" %}
                                    {% if start_date == end_date %}
                                        {{ event_data.event.start|date:"M. d, Y" }} <br>
                                        {{ event_data.event.start|date:"g:i a" }} <br>
                                        {{ event_data.event.end|date:"g:i a" }} <br> 
                                    {% else %}
                                         {{ event_data.event.start|date:"M. d, Y, g:i a" }} <br>
                                         {{ event_data.event.end|date:"M. d, Y, g:i a" }}  
                                    {% endif %}
                                {% endwith %}
                                {% endwith %}
                            </td>
                            <td><a href="{% url 'show-project' event_data.event.application.project.id %}">{{ event_data.event.application }}</a></td>
                          
                            <td><a href="{% url 'show-faculty' event_data.event.application.adviser.id %}">{{ event_data.event.application.adviser }}</a></td>
                            
                            
                            <!-- Loop through the panelists and display their last name -->
                            {% for panelist in event_data.event.application.panel.all %}
                            <td>
                                <a href={% url 'show-faculty' panelist.id %}>
                                    {{ panelist.last_name }} </a> </td>

                            {% endfor %}

                            <!-- Add extra cells for missing panelists -->
                            {% for _ in event_data.extra_cells|to_range %}
                                <td>&nbsp;</td> <!-- Add empty cells for missing panelists -->
                            {% endfor %}
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="text-center">No schedules found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

            <!-- Maximize Button -->
          
        </div>
    
    <!-- Include the modal -->
    {% include 'defense_schedule/create_defense_schedule_modal.html' %}
    
    {% else %}
        <h1> Sorry! Please login first to view this Page. </h1> 
    </br> </br> 
        <a href="{% url 'login' %}"> Login Here </a>

    {% endif %}

    <script>
        
        document.addEventListener("DOMContentLoaded", function () {
            const toggleButton = document.getElementById("toggle-defense-schedule-btn");
            const maximizeButton = document.getElementById("maximize-defense-schedule-btn");
            const defenseScheduleColumn = document.getElementById("defense-schedule-column");
            const calendarColumn = document.getElementById("calendar-column");
    
            toggleButton.addEventListener("click", function () {
                // Minimize the defense schedule
                defenseScheduleColumn.style.display = "none";
                calendarColumn.style.width = "100%"; // Make the calendar full width
                toggleButton.classList.add("d-none"); // Hide minimize button
                maximizeButton.classList.remove("d-none"); // Show maximize button
            });
    
            maximizeButton.addEventListener("click", function () {
                // Maximize the defense schedule
                defenseScheduleColumn.style.display = "block";
                calendarColumn.style.width = "65%"; // Restore original width
                maximizeButton.classList.add("d-none"); // Hide maximize button
                toggleButton.classList.remove("d-none"); // Show minimize button
            });
        });
    </script>
    
    
{% endblock %}