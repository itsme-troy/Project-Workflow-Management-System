{% extends 'project/base.html' %}
{% load static %}
{% load custom_filters %}


{% block content %}

<div class="table-container defense-application-list"> 
    <center>
        <h1 style="display: inline-block;"> Defense Application List</h1> 

        <div style="margin-right: 10px; float: right;"> <!-- Changed to float right -->
            <div class="button-container" style="float: right; margin-left: 15px;">  <!-- Using gap to space out buttons -->
                <a href="javascript:history.back()" class="btn btn-outline-secondary btn-sm">Back</a>
            </div>
        </div> 
    </center>

{% if not defense_applications %}
    <div class="alert custom-error-alert no-timeout-alert" role="alert">
        <h5> No Defense Applications available at the moment. </h5>
    </div>

{% else %}
        <table class="table table-hover table-bordered table">
            <thead>
                <tr>
                    <th scope="col"> #  </th>
                    <th scope="col"> Type of Defense </th>
                    <th scope="col" class="project-name-header">Project Name</th>
                    <th scope="col"> Proponents </th> <!-- New column for Proponents -->
                    <th scope="col"> Adviser </th>
                    <th scope="col"> Date Submitted </th>
                    <th scope="col"> Action </th>
                    <th scope="col"> Verdict </th>
                   
                </tr>
            </thead>
            <tbody>
            <ul>
                {% for application in defense_applications %}
                {% if application.project.status == 'approved' %}
                <tr>
                    <td> <strong>{{ forloop.counter }}</strong></td>
                    <td class="project-name-cell">{{ application.get_title_display }}</td>
                    <td><a href="{% url 'show-project' application.project.id %}">{{ application.project }}</a></td>
                    
                    <td>  <!-- Display proponents -->
                        {{ application.project.proponents}} </td>
            
                    <td>
                        <a href="{% url 'show-faculty' application.project.adviser.id %}">
                            {{ application.adviser.last_name }}
                       </a>
                    </td>
                    
                    <td>{{ application.submission_date|date:"M j, Y g:i A" }}</td> 
                    
                    <td>
                        <a href="{% url 'show-application' application.id %}"
                        class="btn btn-outline-secondary btn-sm">View Application</a> 
                    </td>

                    <td>
                        {% with form=verdict_forms|get_item:application.id %}
                        {% if form %}
                            {% if form.instance.verdict != "pending" %}
                                <p>{{ form.instance.get_verdict_display }}</p>
                            {% else %}
                                <form method="post" action="{% url 'submit_verdict' application.id %}" class="compact-form">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        {{ form.as_p }}
                                    </div>
                                    <button type="submit" class="btn btn-primary" 
                                        onclick="return confirm('Are you sure you want to submit the verdict?');">Submit Verdict</button>  </form>
                            {% endif %}
                        {% else %}
                            <p>No form available for this application.</p>
                        {% endif %}
                        {% endwith %}
                    </td>
                 
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>

{% endif %}
</div>
{% endblock %}