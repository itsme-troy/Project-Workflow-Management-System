{% extends 'project/base.html' %}

{% load custom_filters %}

{% block content %}

</br>
<center>
    <h1> Defense Application List </h1> </br>

    <br/>
    <table class="table table-striped table-hover table-bordered table">
        <thead>
            <tr>
                <th scope="col"> Type of Defense </th>
                <th scope="col"> Project Name </th>
                <th scope="col"> Adviser </th>
                <th scope="col"> Verdict </th>
            </tr>
        </thead>
        <tbody>
        <ul>
            {% for application in defense_applications %}
            {% if application.project.approved %}
            <tr>
                <td>{{ application.title }}</td>
                <td><a href="{% url 'show-project' application.project.id %}">{{ application.project }}</a></td>
                <td>{{ application.adviser }}</td>
                <td>
                    {% with form=verdict_forms|get_item:application.id %}
                    {% if form %}
                        <!-- Check if the verdict has already been submitted -->
                        {% if form.instance.verdict != "pending" %}
                            <!-- Display the already submitted verdict -->
                            <p>{{ form.instance.get_verdict_display }}</p>
                        {% else %}
                            <!-- Show the form only if the verdict hasn't been submitted -->
                            <form method="post" action="{% url 'submit_verdict' application.id %}">
                                {% csrf_token %}
                                {{ form.as_p }} <!-- Render the form -->
                                <button type="submit" class="btn btn-primary">Submit Verdict</button>
                            </form>
                        {% endif %}
                    {% else %}
                        <p>No form available for this application.</p>
                    {% endif %}
                    {% endwith %}
                </td>
            </tr>
            {% endif %}
            {% endfor %}
        </tbody>
    </table>

</center>

{% endblock %}
