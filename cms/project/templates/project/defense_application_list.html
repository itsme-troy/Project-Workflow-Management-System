{% extends 'project/base.html' %}
{% load static %}
{% load custom_filters %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <script src="{% static 'js/custom.js' %}"></script>
{% endblock %}

{% block content %}

</br>
<center>
    <h1> Defense Application List </h1> 

{% if not defense_applications %}
    <div class="alert custom-error-alert text-center no-timeout-alert" role="alert">
        <h5> No Defense Applications available at the moment. </h5>
    </div>

{% else %}
        <table class="table table-hover table-bordered table">
            <thead>
                <tr>
                    <th scope="col"> #  </th>
                    <th scope="col"> Type of Defense </th>
                    <th scope="col"> Project Name </th>
                    <th scope="col"> Proponents </th> <!-- New column for Proponents -->
                    <th scope="col"> Adviser </th>
                    <th scope="col"> Date Submitted </th>
                    <th scope="col"> Verdict </th>
                </tr>
            </thead>
            <tbody>
            <ul>
                {% for application in defense_applications %}
                {% if application.project.status == 'approved' %}
                <tr>
                    <td> <strong>{{ forloop.counter }}</strong></td>
                    <td>{{ application.get_title_display }}</td>
                    <td><a href="{% url 'show-project' application.project.id %}">{{ application.project }}</a></td>
                    
                    <td>  <!-- Display proponents -->
                        {{ application.project.proponents}} </td>
            
                    <td>{{ application.adviser }}</td>
                    
                    <td>{{ application.submission_date|date:"M j, Y g:i A" }}</td> 
                    <td>
                        {% with form=verdict_forms|get_item:application.id %}
                        {% if form %}
                            {% if form.instance.verdict != "pending" %}
                                <p>{{ form.instance.get_verdict_display }}</p>
                            {% else %}
                                <form method="post" action="{% url 'submit_verdict' application.id %}" class="compact-form">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        {{ form.as_p }}
                                    </div>
                                    <button type="submit" class="btn btn-primary" 
                                        onclick="return confirm('Are you sure you want to submit the verdict?');">Submit Verdict</button>  </form>
                            {% endif %}
                        {% else %}
                            <p>No form available for this application.</p>
                        {% endif %}
                        {% endwith %}
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>

    </center>
{% endif %}

{% endblock %}