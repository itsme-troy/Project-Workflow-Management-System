{% extends 'project/base.html' %}
{% load static %}
<head>
    <link rel="stylesheet" href="{% static 'css/custom-navbar.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>

{% block content %}

        <h1>Official Project Group List</h1>

{% if not project_groups_with_proponents %} <!-- Check if projects list is empty -->
    <center>
        <div class="alert alert-danger text-center" role="alert">
            <h4> No Project Groups Available at the moment. </h4>
        </div>
    </center>
{% else %}

    <table class="table table-hover table-bordered">
        <thead class="thead-dark">
            <tr>
                <th scope="col"> # </th>
                <th scope="col">Proponent 1</th>
                <th scope="col">Proponent 2</th>
                <th scope="col">Proponent 3</th>
                {% if user.is_current_coordinator %}
                    <th scope="col" class="action-column"> Action </th> 
                {% endif %}

            </tr>
        </thead>
        <tbody>
            {% for group_data in project_groups_with_proponents %}  
                <tr onclick="toggleActions(this)" {% if user in group_data.proponents %}class="table-warning"{% endif %}>
                    <td><strong>{{ forloop.counter0|add:project_groups_with_proponents.start_index }}</strong></td> <!-- Continuous counter -->
                    {% for proponent in group_data.proponents %}
                        <td>
                            {% if proponent.profile_image and proponent.profile_image.url != '/media/static/images/default_profile_pic.jpg' %}
                                <img src="{{ proponent.profile_image.url }}" alt="profile_pic" class="user-pic-table img-fluid larger-img" style="margin-bottom: 5px;">
                            {% else %}
                            {% comment %} no {% endcomment %}
                                <img src="{% static '/images/default_profile_pic.jpg' %}" class="img-fluid user-pic-table larger-img"  style="margin-bottom: 5px;"> 
                            {% endif %}

                            {% if proponent %}
                                {{ proponent.first_name }} {{ proponent.last_name }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                    {% endfor %}
                    {% if user.is_current_coordinator %}
                        <td class="action-cell">
                            <span class="hint-button" onclick="showActions(this)">Click to show actions</span>
                            <div class="action-buttons small-btn" style="display: none;">

                                <a href="{% url 'delete-project-group' group_data.group.id %}"
                                class="btn btn-outline-danger btn-sm"
                                onclick="return confirm('Are you sure you want to delete this Project Group?');">Delete Group </a> 
                            </div> 
                        
                        </td> 
                    {% endif %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endif %}  
    <hr/>

<nav aria-label="Page navigation example">
    <ul class="pagination justify-content-center">

    {% if project_groups_with_proponents.has_previous %}
        <li class="page-item"><a class="page-link" href="?page=1">&laquo; First</a></li>
        <li class="page-item"><a class="page-link" href="?page={{project_groups_with_proponents.previous_page_number}}">Previous</a></li>
    {% endif %}

 
    {% for i in nums %}
    <li class="page-item {% if forloop.counter == project_groups_with_proponents.number %}disabled{% endif %}">
    <a class="page-link" href="?page={{forloop.counter}}">{{ forloop.counter }}</a>
</li>
    {% endfor %}
    {% if project_groups_with_proponents.has_next %}
        <li class="page-item"> <a class="page-link" href="?page={{project_groups_with_proponents.next_page_number}}">Next</a></li>
        <li class="page-item"> <a class="page-link" href="?page={{project_groups_with_proponents.paginator.num_pages}}">Last &raquo;</a></li>
    {% endif %}
    
    <li class="page-item ml-auto disabled"><a href="#" class="page-link"> Page {{ students.number }} of {{ students.paginator.num_pages }} </a></li>

</ul>
</nav>


<script>
    function toggleActions(row) {
        // Remove active class from all rows
        document.querySelectorAll('tr').forEach(tr => tr.classList.remove('active'));
        // Add active class to clicked row
        row.classList.add('active');
    }

    function showActions(hintButton) {
        // Hide all hint buttons and show action buttons
        document.querySelectorAll('.hint-button').forEach(btn => btn.style.display = 'inline');
        document.querySelectorAll('.action-buttons').forEach(btns => btns.style.display = 'none');

        // Show the action buttons for the clicked row and hide the hint button
        hintButton.style.display = 'none';
        hintButton.nextElementSibling.style.display = 'block'; // Show action buttons
    }

    // Add click handler to close rows when clicking outside
    document.addEventListener('click', function(event) {
        if (!event.target.closest('tr')) {
            document.querySelectorAll('tr').forEach(tr => tr.classList.remove('active'));
            // Reset hint buttons and action buttons
            document.querySelectorAll('.hint-button').forEach(btn => btn.style.display = 'inline');
            document.querySelectorAll('.action-buttons').forEach(btns => btns.style.display = 'none');
        }
    });
</script>



{% endblock %}