{% extends 'project/base.html'%} <!-- use the base file -->
{% load static %}


{% block content %} <!-- content of all web pages go -->


{% comment %} <div class="card">
    <div class="card-header">
      System Report  
    </div>
    <div class="card-body">
     <p class="card-text">Student Count: {{ student_count }} </p>
     <p class="card-text">Faculty Count: {{ faculty_count }} </p>
     <p class="card-text">Project Count: {{ project_count }}</p>
     <p class="card-text">Proposal Count: {{ proposal_count }} </p>
   
    </div>
  </div> </br> {% endcomment %}

<div class="text-start"> 
    <a href="{% url 'coordinator-approval-faculty' %}" class="btn btn-primary">
        <i class="fas fa-chalkboard-teacher icon icon-margin"></i> Go to Faculty Approval
    </a> 
</div> </br> 

  <form action="" method=POST> 
    {% csrf_token %} 

    <center>
    <h1 style="display: inline-block;"> Student Eligibility Approval Form </h1> 
    <div class="text-end" style="margin-left: 20px; float: right;"> <!-- Changed to float right -->
        <button class="btn btn-success mb-3" type="submit">Save All Changes</button>
    </div> </center> 


<table class="table table-hover table-bordered">  
    <thead> 
        <tr> 
            <th scope="col"> # </th> 
            <th scope="col"> Last Name </th> 
            <th scope="col"> First Name </th> 
            <th scope="col" style="width: 100px;" onclick="toggleAllCheckboxes()"> Eligibility 
                <span class="hint-button" title="Click to toggle eligibility checkboxes">?</span>
            </th> 
            <th scope="col" class="deficiencies-column" >
                Deficiencies
            </th>
            
            <th scope="col" style="width: 300px;">Actions</th>
            
            {% comment %} <th scope="col"> Eligibility Deficiencies  </th>  {% endcomment %}
        </tr> 
    </thead>  
    <tbody>

    {% for student in student_list %} 

        <tr onclick="toggleActions(this)">
            <td><strong> {{ forloop.counter }} </strong></td>
            <td> {{ student.last_name }} </td> 
            <td> {{ student.first_name }} </td>

            <td class="checkbox-cell">
                <div class="form-check" style="display: none;">
                    <input class="form-check-input"
                        type="checkbox" 
                        {% if student.eligible %} checked="checked" {% endif %}
                        value="{{ student.id }}" 
                        name="student_box">
                </div>
            </td>
            
            <td class="deficiencies-cell">
                <div style="overflow-x: auto; white-space: nowrap;">
                    {% if student.deficiencies %}
                            {{ student.deficiencies }}
                    {% else %}
                        <span class="text-muted">No deficiencies</span>
                    {% endif %}
                </div> 
            </td>

            <td>  
                <span class="hint-button" onclick="showActions(this)">Click to show actions</span>   
                <div class="action-buttons small-btn" style="display: none;">

                
                    <a href="{% url 'update-deficiencies' student.id %}" class="btn btn-outline-secondary btn-sm mb-1">
                         Update Deficiencies </a> 

                    <a href="{% url 'delete-user' student.id %}" 
                        class="btn btn-outline-danger btn-sm"
                        onclick="return confirm('Are you sure you want to delete this user?');">
                        Delete User
                        </a>
                  
                </div> 
            </td>
                    {% comment %} <td> {{ student.eligibilty_deficiencies }}</td> 
            <td> <a href="{% url 'update_deficiencies' 'student.id' %}" > Update </a>  </td>  {% endcomment %}
        </tr>
       
    {% endfor %}
    </tbody> 
</table>
<p class="help-text text-end">Click the "Eligibility" column header to display checkboxes.</p>


<script>
    
    function toggleAllCheckboxes() {
        const checkboxDivs = document.querySelectorAll('.form-check');
        checkboxDivs.forEach(div => {
            div.style.display = (div.style.display === 'none') ? 'block' : 'none';
        });
    }

    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelector(this.getAttribute('href')).scrollIntoView({
                behavior: 'smooth'
            });
        });
    });

    // Example of form validation
    document.querySelector('form').addEventListener('submit', function(e) {
        const checkboxes = document.querySelectorAll('input[name="student_box"]:checked');
        if (checkboxes.length === 0) {
            e.preventDefault();
            alert('Please select at least one student.');
        }
    });

    function toggleActions(row) {
        // Remove active class from all rows
        document.querySelectorAll('tr').forEach(tr => tr.classList.remove('active'));
        // Add active class to clicked row
        row.classList.add('active');
    }

    function showActions(hintButton) {
        // Hide all hint buttons and show action buttons
        document.querySelectorAll('.hint-button').forEach(btn => btn.style.display = 'inline');
        document.querySelectorAll('.action-buttons').forEach(btns => btns.style.display = 'none');

        // Show the action buttons for the clicked row and hide the hint button
        hintButton.style.display = 'none';
        hintButton.nextElementSibling.style.display = 'block'; // Show action buttons
    }

    // Add click handler to close rows when clicking outside
    document.addEventListener('click', function(event) {
        if (!event.target.closest('tr')) {
            document.querySelectorAll('tr').forEach(tr => tr.classList.remove('active'));
            // Reset hint buttons and action buttons
            document.querySelectorAll('.hint-button').forEach(btn => btn.style.display = 'inline');
            document.querySelectorAll('.action-buttons').forEach(btns => btns.style.display = 'none');
        }
    });

    
</script>


{% endblock %}