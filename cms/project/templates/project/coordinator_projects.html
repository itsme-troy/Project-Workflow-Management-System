{% extends 'project/base.html'%} <!-- use the base file -->
{% load static %}

{% block content %} <!-- content of all web pages go -->
 
<div class="table-container"> 
    <div class="header-container">
        <h1 class="page-title"> PROJECTS </h1> 

        <div class="header-buttons">
            <a href="javascript:history.back()" class="btn btn-outline-secondary btn-sm">
                <i class="fas fa-arrow-left"></i>
            </a>
        </div>
    </div>

{% if not approved_projects_with_groups %}
    <div class="alert custom-info-alert" role="alert">
     <h5>   No Projects Available at the moment. </h5>
    </div>

{% else %}
  
    <div class="table-reponsive">
        <table class="table table-hover table-bordered student-table">
            <thead>
                <tr>
                    <th scope="col"> # </th>
                    <th scope="col" class="project-name-header">Project Name</th>
                    <th scope="col" style="proponents-column">Proponents</th>
                    <th scope="col">Adviser</th>
                    <th scope="col">Panel 1</th>
                    <th scope="col">Panel 2</th>
                    <th scope="col">Panel 3</th>
                    
                    {% if user.is_current_coordinator %}
                         <th scope="col" class="action-column">Actions</th>
                    {% endif %}
                    
                    <th scope="col">Status </th>
                
                </tr>
            </thead>
            <tbody>
                {% if approved_projects_with_groups %}
                    {% for project_data in approved_projects_with_groups %}
                        <tr onclick="toggleActions(this)">
                            <td><strong>{{ forloop.counter|add:start_index }}</strong></td>
                            <td class="project-name-cell">
                                <a href="{% url 'show-project' project_data.project.id %}">{{ project_data.project }}</a>  </td>
                            
                            <td>{{ project_data.project.proponents }}</td>

                                <td>
                                    <a href="{% url 'show-faculty' project_data.project.adviser.id %}">
                                         {{ project_data.project.adviser.last_name }}
                                    </a>
                                </td>

                            {% for panelist in project_data.panel %}
                            <td>
                                {% if panelist %}
                                    <a href="{% url 'show-faculty' panelist.id %}">
                                         {{ panelist.last_name }}
                                    </a>
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            {% endfor %}
                                                        
                                {% if user.role == 'COORDINATOR' %}
                                <td class="action-cell">
                                        <span class="hint-button" onclick="showActions(this)">Click to show actions</span>
                                        
                                        <!-- Action buttons container, initially hidden -->
                                        <div class="action-buttons" style="display: none;">
                                            <a href="{% url 'select-panelist-coordinator' project_data.project.id %}"
                                            class="btn btn-outline-secondary btn-sm">Select Panelist</a> 
                                
                                            <a href="{% url 'archive-project' project_data.project.id %}"
                                            class=" btn btn-outline-info btn-sm"
                                            onclick="return confirm('Are you sure you want to archive this project?');">Archive Project</a>  

                                        </div> 
                                   </td>   {% endif %}

                                    <td>
                                        <span class="badge 
                                            {% if project_data.project.status == 'approved' %}
                                                bg-success
                                            {% elif project_data.project.status == 'pending' %}
                                                bg-warning text-dark
                                            {% elif project_data.project.status == 'declined' %}
                                                bg-danger
                                            {% else %}
                                                bg-secondary
                                            {% endif %}
                                        "> {{ project_data.project.status }}
                                        </span>  </td>
                        </tr>
                    {% endfor %}
                
            {% endif %}
            </tbody>
        </table>  <hr/> 
    </div>


<nav aria-label="Page navigation example">
    <ul class="pagination justify-content-center">
    
        <!-- Ensures that both the filter and the pagination number persist across pages. -->
        {% if projects.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page=1">&laquo; First</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ projects.previous_page_number }}">Previous</a>
            </li>
        {% endif %}

        {% for i in nums %}
        <li class="page-item {% if forloop.counter == projects.number %}disabled{% endif %}">
            <a class="page-link" href="?page={{ forloop.counter }}">{{ forloop.counter }}</a>
        </li>
        {% endfor %}

        {% if projects.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ projects.next_page_number }}">Next</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ projects.paginator.num_pages }}">Last &raquo;</a>
            </li>
        {% endif %}
        
        <li class="page-item ml-auto disabled">
            <a href="#" class="page-link"> Page {{ projects.number }} of {{ projects.paginator.num_pages }} </a>
        </li>
    </ul>
</nav>
</div>
</div>
{% endif %}

    <script>
        function toggleActions(row) {
            // Remove active class from all rows
            document.querySelectorAll('tr').forEach(tr => tr.classList.remove('active'));
            // Add active class to clicked row
            row.classList.add('active');
        }

        function showActions(hintButton) {
            // Hide all hint buttons and show action buttons
            document.querySelectorAll('.hint-button').forEach(btn => btn.style.display = 'inline');
            document.querySelectorAll('.action-buttons').forEach(btns => btns.style.display = 'none');

            // Show the action buttons for the clicked row and hide the hint button
            hintButton.style.display = 'none';
            hintButton.nextElementSibling.style.display = 'block'; // Show action buttons
        }

        // Add click handler to close rows when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('tr')) {
                document.querySelectorAll('tr').forEach(tr => tr.classList.remove('active'));
                // Reset hint buttons and action buttons
                document.querySelectorAll('.hint-button').forEach(btn => btn.style.display = 'inline');
                document.querySelectorAll('.action-buttons').forEach(btns => btns.style.display = 'none');
            }

            function showActions(button) {
                const row = button.closest('tr');  // Get the closest row
                const actionButtons = row.querySelector('.action-buttons');
            
                // Toggle active state for the row
                row.classList.toggle('active');
            
                // Toggle the display of action buttons
                if (row.classList.contains('active')) {
                    actionButtons.style.display = 'flex';  // Show actions
                } else {
                    actionButtons.style.display = 'none';  // Hide actions
                }
            }
        });
    </script>
{% endblock %}

