<div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="border-radius: 12px; overflow: hidden;">
          <!-- Modal Header -->
          <div class="modal-header bg-primary text-white">
              <h5 class="modal-title" id="settingsModalLabel">
                  <i class="fas fa-cog me-2"></i> Settings
              </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <!-- Modal Body -->
          <div class="modal-body p-4">
              <div class="settings-section mb-4">
                <h6 class="text-muted mb-3"><i class="fas fa-sliders-h me-2"></i> Submission Settings</h6>
                <div class="d-flex align-items-center">
                    <input 
                        class="form-check-input me-3" 
                        type="checkbox" 
                        id="allowDefenseApplications" 
                        style="transform: scale(1.3);"
                    >
                    <label 
                        class="form-check-label mb-0" 
                        for="allowDefenseApplications" 
                        style="font-size: 1rem; cursor: pointer;"
                    >
                        <strong>Allow Defense Application Submissions</strong>
                    </label>
                  </div>
              </div>

              <div class="settings-section mb-4">
                  <h6 class="text-muted mb-3"><i class="fas fa-users me-2"></i> Project Group Settings</h6>
                  <div class="form-group">
                      <label for="numProponents"><strong>Number of Proponents per Project Group:</strong></label>
                      <input type="number" id="numProponents" class="form-control" value="3" min="1" max="10" style="max-width: 100px;">
                  </div>
              </div>
          </div>

          <!-- Modal Footer -->
          <div class="modal-footer d-flex justify-content-between">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                  <i class="fas fa-times me-1"></i> Cancel
              </button>
              <button type="button" class="btn btn-primary" id="saveSettings">
                  <i class="fas fa-save me-1"></i> Save Changes
              </button>
          </div>
      </div>
  </div>
</div>


<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Fetch current settings
    fetch("{% url 'project_group_settings' %}")
        .then((response) => response.json())
        .then((data) => {
            if (data.maxProponents) {
                document.getElementById('numProponents').value = data.maxProponents;
            }
            if (data.allowDefenseApplications !== undefined) {
                document.getElementById('allowDefenseApplications').checked = data.allowDefenseApplications;
            }
        });

    // Save settings
    document.getElementById('saveSettings').addEventListener('click', function () {
        const numProponents = document.getElementById('numProponents').value;
        const allowDefenseApplications = document.getElementById('allowDefenseApplications').checked;

        // Send AJAX request to save settings
        fetch("{% url 'save_project_group_settings' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}', // Include CSRF token for security
            },
            body: JSON.stringify({
                numProponents: numProponents,
                allowDefenseApplications: allowDefenseApplications,
            }),
        })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    alert('Settings updated successfully!');
                    location.reload();
                } else {
                    alert(`Error saving settings: ${data.error || "Unknown error"}`);
                }
            })
            .catch((error) => {
                console.error('Error:', error);
                alert('Error saving settings.');
            });
    });
});

</script>
         