{% extends 'project/base.html'%} <!-- use the base file -->
{% load static %}

{% block content %} <!-- content of all web pages go -->

<div class="table-container"> 

<div style="display: flex; justify-content: space-between; align-items: center;">
    <h1 style="display: inline-block;"> Senior Project Ideas </h1>
    {% if request.user.role == "FACULTY" %}
        <div class="button-container">
            <a href="{% url 'submit-project-idea' %}" class="btn btn-add-proposal" style="padding: 10px 20px; border-radius: 5px; background-color: #007bff; color: white; text-decoration: none; transition: background-color 0.3s;">
                <i class="fas fa-plus"></i> Submit Project Idea 
            </a>
        </div>
    {% endif %}
</div>

{% if not project_ideas %} <!-- Check if there are no project ideas -->
        
    <center>
        <div class="alert alert-danger" role="alert">
            <h4> No project ideas available at the moment. </h4> 
        </div> </center>
        
{% else %}
    
    <table class="table table-hover table-bordered"> <!-- Table for project ideas -->
        <thead>
            <tr>
                <th>#</th> <!-- Loop counter -->
                <th>Project Title</th> <!-- Project title header -->
                <th scope="col" class="description-column"> Description </th> 
                
                {% if request.user.role == 'FACULTY' or request.user.is_current_coordinator %}
                    <th scope="col" class="action-column"> Action </th> 
                {% endif %}
                
            </tr>
        </thead>
        <tbody>
            {% for idea in project_ideas %}
                <tr onclick="toggleActions(this)">
                    
                    <td><strong>{{ forloop.counter0|add:project_ideas.start_index }}</strong></td> <!-- Continuous counter -->
                    
                    <td><a href="{% url 'show-project-idea' idea.id %}">{{ idea.title }}</a></td> <!-- Project title link -->
                    <td class="description-cell">
                        <div style="overflow-x: auto; white-space: nowrap;"> 
                            {% if idea.description %}
                                {{ idea.description }}
                            {% else %}
                                <span class="text-muted">No description </span>
                            {% endif %}
                        </div>
                    </td>
                    
                    {% if request.user.role == 'FACULTY' or request.user.is_current_coordinator %}
                        <td class="action-cell">
                            {% if user == idea.faculty or user.is_current_coordinator%}
                                <span class="hint-button" onclick="showActions(this)"> Click to show actions </span>
                                <div class="action-buttons small-btn" style="display: none;">
                                    {% if not request.user.is_current_coordinator%}
                                    <a href="{% url 'update-project-idea' idea.id %}" class="btn btn-outline-secondary btn-sm"> Update Idea </a> 
                                    {% endif %}
                                    
                                    <a href="{% url 'delete-project-idea' idea.id %}" class="btn btn-outline-danger btn-sm" onclick="return confirm('Are you sure you want to delete this project?');">Delete Idea </a> 
                                </div> 
                            {% endif %} 
                        </td> 
                    {% endif %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endif %} <!-- End of project ideas check -->

<hr/> 

<nav aria-label="Page navigation example">
  <ul class="pagination justify-content-center">

  {% if project_ideas.has_previous %}
      <li class="page-item"><a class="page-link" href="?page=1">&laquo; First</a></li>
      <li class="page-item"><a class="page-link" href="?page={{project_ideas.previous_page_number}}">Previous</a></li>
  {% endif %}


  {% for i in nums %}
  <li class="page-item {% if forloop.counter == project_ideas.number %}disabled{% endif %}">
  <a class="page-link" href="?page={{forloop.counter}}">{{ forloop.counter }}</a>
</li>
  {% endfor %}
  {% if project_ideas.has_next %}
      <li class="page-item"> <a class="page-link" href="?page={{project_ideas.next_page_number}}">Next</a></li>
      <li class="page-item"> <a class="page-link" href="?page={{project_ideas.paginator.num_pages}}">Last &raquo;</a></li>
  {% endif %}
  
  <li class="page-item ml-auto disabled"><a href="#" class="page-link"> Page {{ project_ideas.number }} of {{ students.paginator.num_pages }} </a></li>

</ul>
</nav> 
</div>
  

    <script>
        function toggleActions(row) {
            // Remove active class from all rows
            document.querySelectorAll('tr').forEach(tr => tr.classList.remove('active'));
            // Add active class to clicked row
            row.classList.add('active');
        }

        function showActions(hintButton) {
            // Hide all hint buttons and show action buttons
            document.querySelectorAll('.hint-button').forEach(btn => btn.style.display = 'inline');
            document.querySelectorAll('.action-buttons').forEach(btns => btns.style.display = 'none');

            // Show the action buttons for the clicked row and hide the hint button
            hintButton.style.display = 'none';
            hintButton.nextElementSibling.style.display = 'block'; // Show action buttons
        }

        // Add click handler to close rows when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('tr')) {
                document.querySelectorAll('tr').forEach(tr => tr.classList.remove('active'));
                // Reset hint buttons and action buttons
                document.querySelectorAll('.hint-button').forEach(btn => btn.style.display = 'inline');
                document.querySelectorAll('.action-buttons').forEach(btns => btns.style.display = 'none');
            }
        });
    </script>

{% endblock %}

