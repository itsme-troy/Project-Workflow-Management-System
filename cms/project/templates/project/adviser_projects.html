{% extends 'project/base.html'%} <!-- use the base file -->

{% block styles %}
<style>
    .action-buttons {
        display: none;
    }
    /* Update display property to flex instead of inline-block for better alignment */
    tr.active .action-buttons {
        display: flex;
        gap: 0.5rem;  /* Add spacing between buttons */
    }
    .hint-button {
        color: #6c757d;
        background: none;
        border: none;
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
        cursor: pointer;
    }
    .hint-button::before {
        content: "â†—";  /* or you could use a FontAwesome icon if you have it */
        margin-right: 0.25rem;
    }

</style>
{% endblock %}

{% block content %} <!-- content of all web pages go -->
 

<h1>Approved Projects</h1>
<table class="table table-striped table-hover table-bordered">
    <thead>
        <tr>
            <th scope="col"> # </th>
            <th scope="col">Project Name</th>
            <th scope="col">Adviser</th>
            <th scope="col">Proponent 1</th>
            <th scope="col">Proponent 2</th>
            <th scope="col">Proponent 3</th>
            <th scope="col">Status </th>
            <th scope="col"> Actions</th>
        </tr>
    </thead>
    <tbody>
        {% if approved_projects_with_groups %}
            {% for project_data in approved_projects_with_groups %}
                <tr onclick="toggleActions(this)">
                    <td> <strong> {{ forloop.counter }} </strong> </td>
                    <td>
                        <a href="{% url 'show-project' project_data.project.id %}">{{ project_data.project }}</a>
                    </td>
                    <td>{{ project_data.project.adviser }}</td>
                    {% for proponent in project_data.proponents %}
                        <td>
                            {% if proponent %}
                                {{ proponent.first_name }} {{ proponent.last_name }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                    {% endfor %}
                    <td>
                        <span class="badge 
                            {% if project_data.project.status == 'approved' %}
                                bg-success
                            {% elif project_data.project.status == 'pending' %}
                                bg-warning text-dark
                            {% elif project_data.project.status == 'declined' %}
                                bg-danger
                            {% else %}
                                bg-secondary
                            {% endif %}
                        "> {{ project_data.project.status }}
                        </span>  </td>
                   
                        <td> 
                            {% if user == project_data.project.adviser %}
                                <span class="hint-button">Click row to show actions</span>
                                <div class="action-buttons">
                                    <a href="{% url 'update-project' project_data.project.id %}"
                                       class="btn btn-outline-secondary btn-sm">Update Project</a> 
                                       <a href="{% url 'reject-project' project_data.project.id %}"
                                       class="btn btn-outline-danger btn-sm"
                                       onclick="return confirm('Are you sure you want to reject this project? This will move it to the Proposals section.');">Reject Project</a> 
                                    <a href="{% url 'delete-project' project_data.project.id %}"
                                       class="btn btn-outline-danger btn-sm"
                                       onclick="return confirm('Are you sure you want to delete this project?');">Delete Project</a> 
                                </div> 
                            {% endif %} </td> 
                    
                </tr>
            {% endfor %}
        {% else %}
        </br> <p>You have no Advisory Projects yet.</p>
    {% endif %}
    </tbody>
</table>  <hr/> 
    <nav aria-label="Approved Projects Pagination">
        <ul class="pagination justify-content-center">
            {% if approved_page_obj.has_previous %}
                <li class="page-item"><a class="page-link" href="?approved_page=1">&laquo; First</a></li>
                <li class="page-item"><a class="page-link" href="?approved_page={{ approved_page_obj.previous_page_number }}">Previous</a></li>
            {% endif %}

            {% for num in approved_page_obj.paginator.page_range %}
                <li class="page-item {% if num == approved_page_obj.number %}active{% endif %}">
                    <a class="page-link" href="?approved_page={{ num }}">{{ num }}</a>
                </li>
            {% endfor %}

            {% if approved_page_obj.has_next %}
                <li class="page-item"><a class="page-link" href="?approved_page={{ approved_page_obj.next_page_number }}">Next</a></li>
                <li class="page-item"><a class="page-link" href="?approved_page={{ approved_page_obj.paginator.num_pages }}">Last &raquo;</a></li>
            {% endif %}
        </ul>
    </nav>

<h1>My Received Proposals </h1>
<table class="table table-striped table-hover table-bordered">
    <thead>
        <tr>
            <th scope="col"> # </th>
            <th scope="col">Project Name</th>
            <th scope="col">Adviser</th>
            <th scope="col">Proponent 1</th>
            <th scope="col">Proponent 2</th>
            <th scope="col">Proponent 3</th>
            <th scope="col"> Status </th> 
            <th scope="col"> Actions</th>
        </tr>
    </thead>
    <tbody>
        {% if not_approved_projects_with_groups %}
            {% for project_data in not_approved_projects_with_groups %}
            
            <tr onclick="toggleActions(this)">
                    <td> <strong> {{ forloop.counter }} </strong> </td>
                    <td>
                        <a href="{% url 'show-proposal' project_data.project.id %}">{{ project_data.project }}</a>
                    </td>
                    <td>{{ project_data.project.adviser }}</td>
                    {% for proponent in project_data.proponents %}
                        <td>
                            {% if proponent %}
                                {{ proponent.first_name }} {{ proponent.last_name }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                    {% endfor %}
                    
                    <td>
                        <span class="badge 
                            {% if project_data.project.status == 'approved' %}
                                bg-success
                            {% elif project_data.project.status == 'pending' %}
                                bg-warning text-dark
                            {% elif project_data.project.status == 'declined' %}
                                bg-danger
                            {% else %}
                                bg-secondary
                            {% endif %}
                        "> {{ project_data.project.status }}
                        </span>
                    </td>

                    <td> 
                        {% if user == project_data.project.adviser %}
                            <span class="hint-button">Click row to show actions</span>
                            <div class="action-buttons">

                                <a href="{% url 'accept-proposal' project_data.project.id %}"
                                class="btn btn-outline-success btn-sm"
                                onclick="return confirm('Are you sure you want to accept this proposal? Accepting will automatically decline other pending proposals received from this group.');"> Accept Proposal  </a> 
                        
                                <a href="{% url 'update-proposal' project_data.project.id %}"
                                    class="btn btn-outline-secondary btn-sm"> Update Proposal </a>   
                                
                                <a href="{% url 'delete-proposal' project_data.project.id %}"
                                    class="btn btn-outline-danger btn-sm"> Delete Proposal  </a> </div>
                        
                        {% endif %} </td>
                </tr>
                {% endfor %}
        {% else %}
            </br> <p>No Proposals At this time.</p>
        {% endif %}
            
    </tbody>
</table>

<hr/> 


<nav aria-label="Not Approved Projects Pagination">
    <ul class="pagination justify-content-center">
        {% if not_approved_page_obj.has_previous %}
            <li class="page-item"><a class="page-link" href="?not_approved_page=1">&laquo; First</a></li>
            <li class="page-item"><a class="page-link" href="?not_approved_page={{ not_approved_page_obj.previous_page_number }}">Previous</a></li>
        {% endif %}

        {% for num in not_approved_page_obj.paginator.page_range %}
            <li class="page-item {% if num == not_approved_page_obj.number %}active{% endif %}">
                <a class="page-link" href="?not_approved_page={{ num }}">{{ num }}</a>
            </li>
        {% endfor %}

        {% if not_approved_page_obj.has_next %}
            <li class="page-item"><a class="page-link" href="?not_approved_page={{ not_approved_page_obj.next_page_number }}">Next</a></li>
            <li class="page-item"><a class="page-link" href="?not_approved_page={{ not_approved_page_obj.paginator.num_pages }}">Last &raquo;</a></li>
        {% endif %}
    </ul>
</nav>
{% comment %} 
<h1> My Project Groups </h1> 
</br> </br> 

<div class="row"> 
    {% for group in project_groups %}
        {% if request.user == group.adviser %}        
                    <div class="col-sm-4 mb-4">
                    <div class="card">
                        <div class="card-header">
                            Name: {{ group.group_name }} 
                        </div>
                        <div class="card-body">
                        <h5 class="card-title"> Adviser: {{ group.adviser}} </h5>
                        <p class="card-text"> 
                            <ul>
                            <li> Proponents: <br/> 
                            {% for student in group.proponents.all%}
                                {{ student }} </br>
                              {% endfor %}
                            </li> 
                            </ul> 
                        
                        </p>
                        </div>
                        {% if user.is_authenticated %}
                        {% if user == group.adviser %}
                            <div class="card-footer text-body-secondary">
                                {% if not group.approved %}  
                                <a href="{% url 'approve-project-group' group.id %}"
                                    class="btn btn-outline-success btn-sm"> Accept Group </a>  
                
                                    <a href="{% url 'delete-project-group' group.id %}"
                                    class="btn btn-outline-danger btn-sm"> Delete Group </a>  
                
                                {% else %}
                                <a href="{% url 'reject-project-group' group.id %}"
                                    class="btn btn-outline-danger btn-sm"> Reject Group </a> 
                                {% endif %}
                                    
                        
                            </div> 
                        {% endif %} 
                        {% endif %}
                        </div>
                    </div>
            {% endif %}
    {% endfor %}
  </div>
      {% endcomment %}
  

    <script>
        function toggleActions(row) {
            // Remove active class from all rows
            document.querySelectorAll('tr').forEach(tr => tr.classList.remove('active'));
            // Add active class to clicked row
            row.classList.add('active');
        }
    
        // Add click handler to close rows when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('tr')) {
                document.querySelectorAll('tr').forEach(tr => tr.classList.remove('active'));
            }
        });
    </script>
{% endblock %}

