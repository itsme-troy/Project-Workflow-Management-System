{% extends 'project/base.html'%} <!-- use the base file -->
{% load static %} 
 

{% block content %} <!-- content of all web pages go -->


<div class="table-container"> 
    <div class="header-container">
        <h1 class="page-title">Archived Projects </h1>

        <div class="header-buttons">
            <a href="javascript:history.back()" class="btn btn-outline-secondary btn-sm">
                <i class="fas fa-arrow-left"></i>
            </a>
        </div>
    </div>

{% if not archived_projects_with_groups %}
    <div class="alert custom-info-alert no-timeout-alert" role="alert">
        <h5> No Archived Projects  at the moment. </h5> 
    </div> </br>

{% else %}        
  
  <div class="table-responsive">
    <table class="table table-hover table-bordered student-table">
        <thead>
            <tr>
                <th scope="col"> # </th>
                <th scope="col">Project Name</th>
                <th scope="col">Proponents</th>
                <th scope="col">Adviser</th>
                <th scope="col">Panel 1</th>
                <th scope="col">Panel 2</th>
                <th scope="col">Panel 3</th>
                <th scope="col"> Actions</th>
                <th scope="col">Status </th>
            
            </tr>
        </thead>
        <tbody>
            {% if archived_projects_with_groups %}
                {% for project_data in archived_projects_with_groups %}
                    <tr onclick="toggleActions(this)">
                        <td> <strong> {{ forloop.counter }} </strong> </td>
                        <td> <a href="{% url 'show-project' project_data.project.id %}">{{ project_data.project }}</a>  </td>
                        <td>{{ project_data.project.proponents }}</td>
                        <td>{{ project_data.project.adviser }}</td>
                        {% for panelist in project_data.panel %}
                        <td>
                            {% if panelist %}
                                {{ project_data.panelist.first_name }} {{ panelist.last_name }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                    {% endfor %}
                        
                            <td> 
                                {% if user.role == 'COORDINATOR' %}
                                <span class="hint-button" onclick="showActions(this)">Click to show actions</span>
                                    <div class="action-buttons small-btn">
                                        {% comment %} <a href="{% url 'select-panelist-coordinator' project_data.project.id %}"
                                           class="btn btn-outline-secondary btn-sm">Select Panelist</a> 
                             {% endcomment %}
                                        <a href="{% url 'unarchive-project' project_data.project.id %}"
                                           class="btn btn-outline-info btn-sm"
                                           onclick="return confirm('Are you sure you want to Unarchive this project?');">Unarchive Project</a> 
                                        
                                        <a href="{% url 'delete-project' project_data.project.id %}"
                                           class="btn btn-outline-danger btn-sm"
                                           onclick="return confirm('Are you sure you want to delete this project?');">Delete Project</a> 
                                    </div> 
                                {% endif %} </td> 
    
                                <td>
                                    <span class="badge 
                                        {% if project_data.project.status == 'approved' %}
                                            bg-success
                                        {% elif project_data.project.status == 'pending' %}
                                            bg-warning text-dark
                                        {% elif project_data.project.status == 'declined' %}
                                            bg-danger
                                        {% else %}
                                            bg-secondary
                                        {% endif %}
                                    "> {{ project_data.project.status }}
                                    </span>  </td>
                        
                        </tr>
                    {% endfor %}
                
            {% endif %}
            </tbody>
        </table>  <hr/> 
  </div>

{% endif %}
    <nav aria-label="Approved Projects Pagination">
        <ul class="pagination justify-content-center">
            {% if approved_page_obj.has_previous %}
                <li class="page-item"><a class="page-link" href="?approved_page=1">&laquo; First</a></li>
                <li class="page-item"><a class="page-link" href="?approved_page={{ approved_page_obj.previous_page_number }}">Previous</a></li>
            {% endif %}

            {% for num in approved_page_obj.paginator.page_range %}
                <li class="page-item {% if num == approved_page_obj.number %}active{% endif %}">
                    <a class="page-link" href="?approved_page={{ num }}">{{ num }}</a>
                </li>
            {% endfor %}

            {% if approved_page_obj.has_next %}
                <li class="page-item"><a class="page-link" href="?approved_page={{ approved_page_obj.next_page_number }}">Next</a></li>
                <li class="page-item"><a class="page-link" href="?approved_page={{ approved_page_obj.paginator.num_pages }}">Last &raquo;</a></li>
            {% endif %}
        </ul>
    </nav>
  
</div>
    <script>
        function toggleActions(row) {
            // Remove active class from all rows
            document.querySelectorAll('tr').forEach(tr => tr.classList.remove('active'));
            // Add active class to clicked row
            row.classList.add('active');
        }
    
        function showActions(hintButton) {
            // Hide all hint buttons and show action buttons
            document.querySelectorAll('.hint-button').forEach(btn => btn.style.display = 'inline');
            document.querySelectorAll('.action-buttons').forEach(btns => btns.style.display = 'none');
    
            // Show the action buttons for the clicked row and hide the hint button
            hintButton.style.display = 'none';
            hintButton.nextElementSibling.style.display = 'block'; // Show action buttons
        }
    
        // Add click handler to close rows when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('tr')) {
                document.querySelectorAll('tr').forEach(tr => tr.classList.remove('active'));
                // Reset hint buttons and action buttons
                document.querySelectorAll('.hint-button').forEach(btn => btn.style.display = 'inline');
                document.querySelectorAll('.action-buttons').forEach(btns => btns.style.display = 'none');
            }
        });
    </script>

{% endblock %}