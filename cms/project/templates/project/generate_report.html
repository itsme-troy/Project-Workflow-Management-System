{% extends 'project/base.html' %}
{% load custom_filters %}
{% load static %}

{% block content %}

<div class="table-container">

<center>
  <h1 style="display: inline-block;"> Projects Defense Progress </h1> 

  <div style="margin-right: 10px; float: right;"> <!-- Changed to float right -->
      
      <div class="button-container" style="float: right; margin-left: 15px;">  <!-- Using gap to space out buttons -->
          <a href="javascript:history.back()" class="btn btn-outline-secondary btn-sm">Back</a>
      </div>

      {% if request.user.role == 'FACULTY' %}
        <div class="button-container" style="float: right; margin-left: 15px;">
          <button id="toggleFilter" class="btn btn-outline-secondary btn-sm">
              {% if my_projects_only %}
                  Show All Projects
              {% else %}
                  Show My Projects
              {% endif %}
          </button>
      </div>
      {% endif %}
  </div> 

</center>


{% if not projects_with_phases %}
  <center> 
    <div class="alert alert-danger" role="alert">
      <h4> No projects Available at the moment. </h4> 
    </div> 
  </center> 

{% else %}
  
  <table class="table table-hover table-bordered">
    <thead>
        <tr>
            <th scope="col" class="project-name-header" style="width: 500px;"> Project Name</th>
            {% comment %} <th scope="col">Proponents</th>  {% endcomment %}
            <th scope="col">Adviser</th>
            <th scope="col">Proposal Defense</th>
            <th scope="col">Design Defense</th>
            <th scope="col">Preliminary Defense</th>
            <th scope="col">Final Defense</th>
        </tr>
    </thead>
    <tbody>
      {% for project_data in projects_with_phases %}
      {% if project_data.project.status == 'approved' %}
          <tr>
              <td class="project-name-cell" style="width: 500px;">
                <a href="{% url 'show-project' project_data.project.id %}">
                    {{ project_data.project }}
                </a>
            </td>
              {% comment %} <td>{{ project_data.project.proponents }}</td> {% endcomment %}



              <td>
                    <a href="{% url 'show-faculty' project_data.project.adviser.id %}">
                      {{ project_data.project.adviser.last_name }}
                  </a>
             </td>
              
              <td class="verdict-{{ project_data.defense_results.proposal|lower|slugify_filter }}">
                  <span class="badge badge-{{ project_data.defense_results.proposal|lower|slugify_filter }}">
                      {{ project_data.defense_results.proposal }}
                  </span>
                  <!-- Debugging  tool -->
                  {% comment %} <small>Class: badge-{{ project_data.defense_results.proposal|lower|slugify_filter }}</small> {% endcomment %}
              </td>
              <td class="verdict-{{ project_data.defense_results.design|lower|slugify_filter }}">
                  <span class="badge badge-{{ project_data.defense_results.design|lower|slugify_filter }}">
                      {{ project_data.defense_results.design }}
                  </span>
              </td>
              <td class="verdict-{{ project_data.defense_results.preliminary|lower|slugify_filter }}">
                  <span class="badge badge-{{ project_data.defense_results.preliminary|lower|slugify_filter }}">
                      {{ project_data.defense_results.preliminary }}
                  </span>
                  <!-- Debugging  tool -->
                  {% comment %} <small>Class: badge-{{ project_data.defense_results.preliminary|lower|slugify_filter }}</small> {% endcomment %}
              </td>
              <td class="verdict-{{ project_data.defense_results.final|lower|slugify_filter }}">
                  <span class="badge badge-{{ project_data.defense_results.final|lower|slugify_filter }}">
                      {{ project_data.defense_results.final }}
                  </span>
              </td>
          </tr>
      {% endif %}
      {% endfor %}
    </tbody>
  </table>  <hr/> </br>
{% endif %}

</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const toggleButton = document.getElementById('toggleFilter');
    const url = new URL(window.location.href);

    // Set initial button text
    const myProjects = url.searchParams.get('my_projects') === 'true';
    toggleButton.textContent = myProjects ? 'Show All Projects' : 'Show My Projects';

    // Toggle filter and button text
    toggleButton.addEventListener('click', function () {
      const filter = url.searchParams.get('my_projects') === 'true' ? 'false' : 'true';
      url.searchParams.set('my_projects', filter);
      toggleButton.textContent = filter === 'true' ? 'Show All Projects' : 'Show My Projects';
      window.location.href = url.toString();
    });
  });
</script>

{% endblock %}