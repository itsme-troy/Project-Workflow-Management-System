{% extends 'project/base.html' %} <!-- use the base file -->
{% load static %}

{% block content %} <!-- content of all web pages go -->

<div class="table-container">
    <div class="header-container">
        <h1 class="page-title">My Submitted Proposals </h1> 

        <div class="header-buttons">
            <a href="{% url 'add-project' %}" class="btn btn-outline-success btn-sm">
                <i class="fas fa-plus"></i> Submit Proposal
            </a>
            <a href="javascript:history.back()" class="btn btn-outline-secondary btn-sm">
                <i class="fas fa-arrow-left"></i>
            </a>
        </div>
    </div>
        <!-- Alert for no projects -->
    {% if not projects %}
    <center> </br>
        <div class="alert custom-info-alert" role="alert">
            <h5>No proposals submitted yet!</h5> 
        </div>
    </center> 
    
    {% else %}   
    <table class="table table-hover table-bordered table">
        <thead>
            <tr>
                <th scope="col"> # </th>
                <th scope="col"> Project Name </th>
                <th scope="col"> Adviser </th>
                <th scope="col"> Project Group </th>
                <th scope="col"> Project Type </th>
                <th scope="col"> Actions </th>
                <th scope="col"> Status </th>
            </tr>
        </thead>
        <tbody>
            {% for project in projects %}
                
                <tr onclick="toggleActions(this)">
                          
                    <td><strong>{{ forloop.counter0|add:projects.start_index }}</strong></td> <!-- Continuous counter -->
                    
                    <td> <a href="{% url 'show-proposal' project.id %}"> {{ project.title }} </a> </td>
                    <td> {{ project.adviser }} </td>
                    <td> {{ project.proponents }} </td>
                    <td> {{ project.project_type }} </td>
                    <td> 
                        <span class="hint-button">Click row to show actions</span>
                        
                        <div class="action-buttons"> <!-- Hide by default -->
                            <a href="{% url 'student-delete-proposal' project.id %}" 
                            class="btn btn-outline-danger btn-sm" 
                            onclick="return confirm('Are you sure you want to delete this proposal?');"> Delete Proposal </a> </div>
                    </td>

                    <td><span class="badge 
                                {% if project.status == 'approved' %}
                                    bg-success
                                {% elif project.status == 'pending' %}
                                    bg-warning text-dark
                                {% elif project.status == 'declined' %}
                                    bg-danger
                                {% else %}
                                    bg-secondary
                                {% endif %}
                            "> {{ project.status }}
                            </span> </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
<br/> <hr/> <br/>
    <!-- Pagination controls -->

    <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center">
        {% if projects.has_previous %}
            <li class="page-item"><a class="page-link" href="?page=1">&laquo; First</a></li>
            <li class="page-item"><a class="page-link" href="?page={{projects.previous_page_number}}">Previous</a></li>
        {% endif %}
        {% for i in nums %}
        <li class="page-item {% if forloop.counter == projects.number %}disabled{% endif %}">
        <a class="page-link" href="?page={{forloop.counter}}">{{ forloop.counter }}</a>
        </li>
        {% endfor %}
        {% if projects.has_next %}
            <li class="page-item"> <a class="page-link" href="?page={{projects.next_page_number}}">Next</a></li>
            <li class="page-item"> <a class="page-link" href="?page={{projects.paginator.num_pages}}">Last &raquo;</a></li>
        {% endif %}
        
        <li class="page-item ml-auto disabled"><a href="#" class="page-link"> Page {{ projects.number }} of {{ students.paginator.num_pages }} </a></li>
        </ul>
    </nav>
</div>

{% endif %}
<script>
    function toggleActions(row) {
        // Remove active class from all rows
        document.querySelectorAll('tr').forEach(tr => tr.classList.remove('active'));
        // Add active class to clicked row
        row.classList.add('active');
    }

    // Add click handler to close rows when clicking outside
    document.addEventListener('click', function(event) {
        if (!event.target.closest('tr')) {
            document.querySelectorAll('tr').forEach(tr => tr.classList.remove('active'));
        }
    });
</script>
{% endblock %}
