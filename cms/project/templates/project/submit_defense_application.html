{% extends 'project/base.html' %}

{% block content %}

</br> 

 Logged in User: {{ request.user.id}} 
 
{% if user.is_authenticated %}
<center> 
    <h1> Submit Defense Application </h1> </br> 

    <br/> <br/> 
</center> 
    {% if submitted %}

        <div class="alert alert-success text-center" role="alert">
            <h3> Your Defense Application Was Submitted Successfully!</h3>
        </div>
        
    {% else %}
         <!-- Display form errors -->
         {% if form.errors %}
            <div class="alert alert-danger">
                <ul class="mb-0">
                    {% for error in form.non_field_errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                        {% for field in form %}
                            {% for error in field.errors %}
                                <li> Please Fix Errors in {{ field.label }} Field </li>
                            {% endfor %}
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}


        <form action="" method="POST" id="capstonesubmissionForm" enctype="multipart/form-data"> 
            {% csrf_token %}
            
           <!-- Show last phase and next phase -->
           <p><strong>Last Phase:</strong> {{ last_phase.phase_type}} <strong> verdict: </strong>  {{ last_phase.verdict }}  {% if last_phase %} {% else %} None </p> {%endif %}
           <p><strong>Next Phase:</strong> {{ next_phase_type }}</p>
            
            <!-- Render form fields -->
           {{ form.as_p }}


            <input type="submit" value="Submit" 
            class="btn btn-secondary">
            <a href="{% url 'list-projects' %}" class="btn btn-danger btn-lg btn-block">Cancel</a> 
        </form> 
    {% endif %}

{% else %}
        <h1> Sorry. Please Login to view this Page. </h1> 

        <a href="{% url 'login' %}">Login Here! </a> 
{% endif %}
<script>
    document.getElementById('capstonesubmissionForm').onsubmit = function() {
        // Enable the proponents and adviser fields before submitting the form
        document.querySelector('select[name="project"]').removeAttribute('disabled');
        document.querySelector('select[name="project_group"]').removeAttribute('disabled');
        document.querySelector('select[name="adviser"]').removeAttribute('disabled');
        document.querySelector('select[name="panel"]').removeAttribute('disabled');
        document.querySelector('select[name="title"]').removeAttribute('disabled');
    };
</script>

{% endblock %}